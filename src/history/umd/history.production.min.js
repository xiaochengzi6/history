!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).HistoryLibrary={})}(this,(function(t){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)}var e;t.Action=void 0,(e=t.Action||(t.Action={})).Pop="POP",e.Push="PUSH",e.Replace="REPLACE";var r="beforeunload",a="popstate";function o(t,n,e){return Math.min(Math.max(t,n),e)}function i(t){t.preventDefault(),t.returnValue=""}function c(){var t=[];return{get length(){return t.length},push:function(n){return t.push(n),function(){t=t.filter((function(t){return t!==n}))}},call:function(n){t.forEach((function(t){return t&&t(n)}))}}}function u(){return Math.random().toString(36).substr(2,8)}function l(t){var n=t.pathname,e=void 0===n?"/":n,r=t.search,a=void 0===r?"":r,o=t.hash,i=void 0===o?"":o;return a&&"?"!==a&&(e+="?"===a.charAt(0)?a:"?"+a),i&&"#"!==i&&(e+="#"===i.charAt(0)?i:"#"+i),e}function f(t){var n={};if(t){var e=t.indexOf("#");e>=0&&(n.hash=t.substr(e),t=t.substr(0,e));var r=t.indexOf("?");r>=0&&(n.search=t.substr(r),t=t.substr(0,r)),t&&(n.pathname=t)}return n}t.createBrowserHistory=function(e){void 0===e&&(e={});var o=e.window,s=void 0===o?document.defaultView:o,h=s.history;function p(){var t=s.location,n=t.pathname,e=t.search,r=t.hash,a=h.state||{};return[a.idx,{pathname:n,search:e,hash:r,state:a.usr||null,key:a.key||"default"}]}var v=null;s.addEventListener(a,(function(){if(v)A.call(v),v=null;else{var n=t.Action.Pop,e=p(),r=e[0],a=e[1];if(A.length){if(null!=r){var o=y-r;o&&(v={action:n,location:a,retry:function(){H(-1*o)}},H(o))}}else E(n)}}));var d=t.Action.Pop,g=p(),y=g[0],m=g[1],b=c(),A=c();function P(t){return"string"==typeof t?t:l(t)}function k(t,e){return void 0===e&&(e=null),n({pathname:m.pathname,hash:"",search:""},"string"==typeof t?f(t):t,{state:e,key:u()})}function x(t,n){return[{usr:t.state,key:t.key,idx:n},P(t)]}function w(t,n,e){return!A.length||(A.call({action:t,location:n,retry:e}),!1)}function E(t){d=t;var n=p();y=n[0],m=n[1],b.call({action:d,location:m})}function H(t){h.go(t)}null==y&&(y=0,h.replaceState(n({},h.state,{idx:y}),""));var L={get action(){return d},get location(){return m},createHref:P,push:function n(e,r){var a=t.Action.Push,o=k(e,r);if(w(a,o,(function(){n(e,r)}))){var i=x(o,y+1),c=i[0],u=i[1];try{h.pushState(c,"",u)}catch(t){s.location.assign(u)}E(a)}},replace:function n(e,r){var a=t.Action.Replace,o=k(e,r);if(w(a,o,(function(){n(e,r)}))){var i=x(o,y),c=i[0],u=i[1];h.replaceState(c,"",u),E(a)}},go:H,back:function(){H(-1)},forward:function(){H(1)},listen:function(t){return b.push(t)},block:function(t){var n=A.push(t);return 1===A.length&&s.addEventListener(r,i),function(){n(),A.length||s.removeEventListener(r,i)}}};return L},t.createHashHistory=function(e){void 0===e&&(e={});var o=e.window,s=void 0===o?document.defaultView:o,h=s.history;function p(){var t=f(s.location.hash.substr(1)),n=t.pathname,e=void 0===n?"/":n,r=t.search,a=void 0===r?"":r,o=t.hash,i=void 0===o?"":o,c=h.state||{};return[c.idx,{pathname:e,search:a,hash:i,state:c.usr||null,key:c.key||"default"}]}var v=null;function d(){if(v)P.call(v),v=null;else{var n=t.Action.Pop,e=p(),r=e[0],a=e[1];if(P.length){if(null!=r){var o=m-r;o&&(v={action:n,location:a,retry:function(){L(-1*o)}},L(o))}}else H(n)}}s.addEventListener(a,d),s.addEventListener("hashchange",(function(){l(p()[1])!==l(b)&&d()}));var g=t.Action.Pop,y=p(),m=y[0],b=y[1],A=c(),P=c();function k(t){return function(){var t=document.querySelector("base"),n="";if(t&&t.getAttribute("href")){var e=s.location.href,r=e.indexOf("#");n=-1===r?e:e.slice(0,r)}return n}()+"#"+("string"==typeof t?t:l(t))}function x(t,e){return void 0===e&&(e=null),n({pathname:b.pathname,hash:"",search:""},"string"==typeof t?f(t):t,{state:e,key:u()})}function w(t,n){return[{usr:t.state,key:t.key,idx:n},k(t)]}function E(t,n,e){return!P.length||(P.call({action:t,location:n,retry:e}),!1)}function H(t){g=t;var n=p();m=n[0],b=n[1],A.call({action:g,location:b})}function L(t){h.go(t)}null==m&&(m=0,h.replaceState(n({},h.state,{idx:m}),""));var O={get action(){return g},get location(){return b},createHref:k,push:function n(e,r){var a=t.Action.Push,o=x(e,r);if(E(a,o,(function(){n(e,r)}))){var i=w(o,m+1),c=i[0],u=i[1];try{h.pushState(c,"",u)}catch(t){s.location.assign(u)}H(a)}},replace:function n(e,r){var a=t.Action.Replace,o=x(e,r);if(E(a,o,(function(){n(e,r)}))){var i=w(o,m),c=i[0],u=i[1];h.replaceState(c,"",u),H(a)}},go:L,back:function(){L(-1)},forward:function(){L(1)},listen:function(t){return A.push(t)},block:function(t){var n=P.push(t);return 1===P.length&&s.addEventListener(r,i),function(){n(),P.length||s.removeEventListener(r,i)}}};return O},t.createMemoryHistory=function(e){void 0===e&&(e={});var r=e,a=r.initialEntries,i=void 0===a?["/"]:a,s=r.initialIndex,h=i.map((function(t){return n({pathname:"/",search:"",hash:"",state:null,key:u()},"string"==typeof t?f(t):t)})),p=o(null==s?h.length-1:s,0,h.length-1),v=t.Action.Pop,d=h[p],g=c(),y=c();function m(t,e){return void 0===e&&(e=null),n({pathname:d.pathname,search:"",hash:""},"string"==typeof t?f(t):t,{state:e,key:u()})}function b(t,n,e){return!y.length||(y.call({action:t,location:n,retry:e}),!1)}function A(t,n){v=t,d=n,g.call({action:v,location:d})}function P(n){var e=o(p+n,0,h.length-1),r=t.Action.Pop,a=h[e];b(r,a,(function(){P(n)}))&&(p=e,A(r,a))}var k={get index(){return p},get action(){return v},get location(){return d},createHref:function(t){return"string"==typeof t?t:l(t)},push:function n(e,r){var a=t.Action.Push,o=m(e,r);b(a,o,(function(){n(e,r)}))&&(p+=1,h.splice(p,h.length,o),A(a,o))},replace:function n(e,r){var a=t.Action.Replace,o=m(e,r);b(a,o,(function(){n(e,r)}))&&(h[p]=o,A(a,o))},go:P,back:function(){P(-1)},forward:function(){P(1)},listen:function(t){return g.push(t)},block:function(t){return y.push(t)}};return k},t.createPath=l,t.parsePath=f,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=history.production.min.js.map
